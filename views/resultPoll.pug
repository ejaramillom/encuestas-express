extends index

block body
  if user && user._id.equals( currentPoll.user._id )
    div( class = 'body-actions' )
      a( href = `/polls/${ currentPoll._id }/edit` )
        i( class = 'far fa-edit' )
      a( href = `/polls/${ currentPoll._id }/delete`, class = 'btn-delete' )
        i( class = 'far fa-trash-alt' )

  div( class = 'body-content' )
    h1( class = 'body-question' )= currentPoll.question
    div( class = 'body-description' ) !{ currentPoll.description || '' }
    div( class = 'body-description' ) Creado por #{ currentPoll.user.email }

  each option in currentPoll.options
    div( class = 'body-content' )
      label( for = `option-${ option._id }` )= option.text
       p #{ option.votes }  Votos
       - let count = Math.round(( option.votes / currentPoll.totalVotes() ) * 100 );
       div( style = { background: 'gray', width: count + '%', height: '2em' })
         span= count + '%'

  script.
    var btnDelete = document.querySelector( '.btn-delete' );
    btnDelete.addEventListener( 'click', function( e ) {
      e.preventDefault();

      if ( confirm( 'EstÃ¡ seguro de borrar la encuesta?' )) {
        fetch( '/polls/#{ currentPoll._id }', {
          method: 'DELETE'
        }).then( response => {
          window.location = '/';
        });
      }
    });
